# 赛事宝服务端

## 1、服务器架构


![Alt text](https://raw.githubusercontent.com/debugEagle/ssb_server/master/resource/design.png?token=ATV0bQGaBa-D23dqAND5-wD-B8Op_IPhks5Xhd41wA%3D%3D "Optional title")

前端服务器：

	服务器地址对外暴露，服务器启用nginx 的反向代理与负载均衡功能，提高前端服务器稳定性，采用此架构有助于将来扩展，比如添加应用服务器2与应用服务器3等等(用虚线图片标示)，目前由于设计初期用户量不大，所以把应用服务器和nginx放在了一台服务器上。

后端服务器:

	服务器地址仅对微信服务器暴露，提高接收微信支付的回调的成功率及支付系统的稳定性。同样，目前把数据库和缓存服务器放在了一台主机上。

## 2、设计思路

### 1) 目标
	赛事宝服务器主要为前端app提供以下几点功能：
	1、赛事的增添查改
		(1) 前端应用服务器接受app的查询请求，并根据查询条件查询相应的赛事，以json的方式返回查询结果(数组)。
		(2) 后端服务器接收管理端(app or pc)的添加和修改及删除请求，直接修改数据库内相应的赛事，并返回操作结果。(此项操作的人员，根据目前的功能及运维设计，由官方运维人员进行操作，在请求前已对所进行的操作进行了审核，对于删除已有用户买票的比赛运维人员要进行资金的退款等相应的操作)。
	2、赛事购票
		(1) 前端应用服务器接受app的订票请求，并在用户账户下生成订单号，将微信等第三方支付的支付参数以json方式返回。
		(2) app调用第三方支付sdk拉起支付窗口并完成支付后，将订单号等信息发送给前端服务器，前端服务器通过微信接口查询真正的付款信息，最后向app端返回结果。
		(3) 线下rebuy?
	3、线下核发
		(1) 当用户到达比赛现场，将app内票据信息出示给工作人员，工作人员使用管理端?(app or pc)通过查询确认接口将票据信息(条码或者序列号)发送给前端服务器，前端服务器进行鉴权操作并返回结果。
